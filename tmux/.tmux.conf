# ---------------------------
# Configuración General
# ---------------------------
set -sg escape-time 10             # Reduce el delay de escape
set -g focus-events on             # Habilita eventos de foco para integración con neovim
set -g base-index 1                # Índices de ventanas empiezan en 1
setw -g pane-base-index 1          # Índices de paneles empiezan en 1
set -g renumber-windows on         # Renumera ventanas cuando se cierran
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",*256col*:Tc"
set -ga terminal-overrides ",*:RGB"
set -g history-limit 100000        # Aumenta el historial del scrollback
set -g mouse on

# ---------------------------
# Atajos Personalizados (Prefix: C-a)
# ---------------------------
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# ---------------------------
# Manejo de Sesiones
# ---------------------------
bind S command-prompt -p "Nombre de sesión:" "new-session -A -s '%%'"
bind B choose-session               # Listar sesiones

# ---------------------------
# Navegación Mejorada
# ---------------------------
bind -n M-h select-pane -L
bind -n M-l select-pane -R
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind > swap-pane -D       # Mover panel a la derecha
bind < swap-pane -U       # Mover panel a la izquierda

# ---------------------------
# Paneles y Ventanas
# ---------------------------
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind C new-window -c "#{pane_current_path}"
bind x kill-pane
bind X kill-window

# ---------------------------
# Mouse y Scroll
# ---------------------------
bind -T copy-mode-vi WheelUpPane send -N1 -X scroll-up
bind -T copy-mode-vi WheelDownPane send -N1 -X scroll-down

# ---------------------------
# Integración con Portapapeles WSL2
# ---------------------------
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "clip.exe"
bind -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "clip.exe"

# ---------------------------
# Floating window (M-g for opening scratch session)
# ---------------------------
bind-key -n M-g if-shell -F '#{==:#{session_name},scratch}' {
  detach-client
} {
  display-popup -E "tmux new-session -A -s scratch"
}

# ---------------------------
# Plugins (TPM)
# ---------------------------
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'samoshkin/tmux-plugin-sysstat'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g @plugin 'sainnhe/tmux-fzf'

# Restauración automática
set -g @continuum-restore 'on'
set -g @resurrect-strategy-nvim 'session'

# Configuración de Sysstat
set -g @sysstat_cpu_color_low "#8BE9FD"
set -g @sysstat_cpu_color_medium "#FFB86C"
set -g @sysstat_cpu_color_high "#FF5555"

# Configuración del indicador de prefix
set -g @prefix_highlight_fg '#1A1B26'
set -g @prefix_highlight_bg '#FF6B9D'
set -g @prefix_highlight_show_copy_mode 'on'
set -g @prefix_highlight_copy_mode_attr 'fg=#1A1B26,bg=#8BE9FD,bold'
set -g @prefix_highlight_prefix_prompt 'PREFIX'
set -g @prefix_highlight_copy_prompt 'COPY'

# Configuración de tmux-fzf
set-environment -g TMUX_FZF_LAUNCH_KEY "F"
set-environment -g TMUX_FZF_OPTIONS "-p -w 80% -h 60% -m --border=rounded --color=fg:#8BE9FD,bg:#1A1B26,hl:#FF6B9D,fg+:#8BE9FD,bg+:#2B2D42,hl+:#FF6B9D,info:#FFB86C,prompt:#FF6B9D,pointer:#FF6B9D,marker:#FF6B9D,spinner:#FFB86C,header:#8BE9FD"
set-environment -g PATH "/home/vctroa/.fzf/bin:$PATH"

# ---------------------------
# Catppuccin (configuración oficial v2.x)
# IMPORTANTE: Configurar ANTES de cargar el plugin
# ---------------------------
set -g @catppuccin_flavor "mocha"
set -g @catppuccin_window_status_style "rounded"

# Cargar catppuccin (ANTES de TPM para que las variables estén disponibles)
run ~/.tmux/plugins/tmux/catppuccin.tmux

# ---------------------------
# Status Bar (DESPUÉS de cargar catppuccin)
# ---------------------------
set -g status-position top
set -g status-right-length 100
set -g status-left-length 100
set -g status-left ""
set -g status-right "#{E:@catppuccin_status_application}"
set -ag status-right "#{E:@catppuccin_status_session}"
set -ag status-right "#{E:@catppuccin_status_directory}"

# ---------------------------
# Inicialización de TPM (SIEMPRE AL FINAL)
# ---------------------------
run '~/.tmux/plugins/tpm/tpm'
